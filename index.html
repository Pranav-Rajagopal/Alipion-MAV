<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Elite Sci-Tech Prototype — v4 Masterpiece</title>

<!-- Fonts + GSAP -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

<style>
  :root{
    --neon:#00ff7f;
    --neon-strong: rgba(0,255,127,1);
    --bg:#000;
    --panel: rgba(0,0,0,0.66);
    --glow: rgba(0,255,127,0.08);
    --maxw:1200px;
    --radius:14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--neon);font-family:"Poppins",sans-serif;-webkit-font-smoothing:antialiased}
  a{color:inherit;text-decoration:none}
  button{font-family:inherit}

  /* subtle grid background */
  #gridBg{position:fixed;inset:0;z-index:-3;opacity:.36;pointer-events:none;
    background:
      radial-gradient(circle at 8% 12%, rgba(0,255,127,0.03) 0%, rgba(0,0,0,0.95) 60%),
      repeating-linear-gradient(#00261a 0px,#00261a 2px,transparent 2px,transparent 56px),
      repeating-linear-gradient(90deg,#00261a 0px,#00261a 2px,transparent 2px,transparent 56px);
    filter:contrast(1.05) saturate(1.08);
  }

  /* Loader */
  #neonLoader{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;z-index:300;background:linear-gradient(180deg, rgba(0,0,0,0.98), rgba(0,0,0,0.95))}
  #bootTitle{font-weight:700;color:var(--neon)}
  #bootStep{font-family:monospace;font-size:1.8rem;text-shadow:0 0 20px var(--neon)}
  .loader-dots{display:flex;gap:8px}
  .loader-dot{width:9px;height:9px;border-radius:50%;background:var(--neon);opacity:.9}

  /* Intro typing */
  #intro{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;gap:16px;z-index:260;background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.6))}
  #typingText{font-size:3rem;font-weight:800;text-align:center;line-height:1;text-shadow:0 0 26px var(--neon)}
  #enterBtn{margin-top:6px;padding:12px 36px;border-radius:12px;border:2px solid var(--neon);background:transparent;color:var(--neon);font-weight:700;cursor:pointer;opacity:0;transform:translateY(8px);transition:all .32s}
  #enterBtn:focus{outline:2px solid rgba(0,255,127,0.08)}
  #enterBtn:hover{background:var(--neon);color:#000}

  /* Founders cinematic - full screen */
  #foundersWrap{position:fixed;inset:0;z-index:250;display:none;overflow:hidden;background:#000}
  .founderScreen{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:28px;opacity:0}
  .founderInner{display:flex;gap:40px;align-items:center;max-width:1200px;width:92%;justify-content:center;flex-wrap:wrap}
  .founderImage{flex:0 0 420px;height:420px;border-radius:14px;overflow:hidden;border:3px solid rgba(0,255,127,0.12);box-shadow:0 40px 140px rgba(0,255,127,0.03)}
  .founderImage img{width:100%;height:100%;object-fit:cover;display:block}
  .founderText{flex:1;min-width:320px;text-align:left}
  .founderText h1{margin:0;font-size:2.8rem;letter-spacing:.6px;text-shadow:0 0 30px rgba(0,255,127,0.06)}
  .founderText p.role{margin:.6rem 0 14px;font-weight:700;color:var(--neon)}
  .founderText p.bio{margin:0;max-width:780px;color:rgba(0,255,127,0.92);line-height:1.6;font-size:1.05rem}

  /* Header (sticky) */
  header{position:sticky;top:0;z-index:220;background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.28));backdrop-filter: blur(6px);display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid rgba(0,255,127,0.04)}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{font-weight:800;letter-spacing:1px;text-shadow:0 0 12px rgba(0,255,127,0.08)}
  .tag{opacity:.68;font-size:.92rem}

  .navWrap{display:flex;gap:12px;align-items:center}
  .nav{display:flex;gap:8px;align-items:center;overflow:auto;padding:6px;border-radius:999px}
  .nav::-webkit-scrollbar{height:8px}
  .navBtn{padding:8px 14px;border-radius:10px;border:1px solid rgba(0,255,127,0.06);background:transparent;color:var(--neon);font-weight:700;cursor:pointer;white-space:nowrap;transition:all .18s}
  .navBtn{ text-shadow: 0 0 8px rgba(0,255,127,0.12), 0 0 18px rgba(0,255,127,0.06); }
  .navBtn:hover{transform:translateY(-3px);box-shadow:0 12px 40px rgba(0,255,127,0.06);border-color:var(--neon)}
  .navBtn.active{background:linear-gradient(90deg, rgba(0,255,127,0.06), rgba(0,255,127,0.02));box-shadow:0 10px 40px rgba(0,255,127,0.04)}

  /* scroll progress */
  #scrollProgress{position:fixed;left:0;right:0;top:0;height:4px;z-index:280;background:linear-gradient(90deg, rgba(0,255,127,0.06), transparent)}
  #scrollProgress > i{display:block;height:100%;width:0;background:linear-gradient(90deg, var(--neon), rgba(0,255,127,0.5));box-shadow:0 6px 20px rgba(0,255,127,0.12) inset;transition:width .08s linear}

  /* Main */
  #main{min-height:100vh;opacity:0;visibility:hidden}
  main{padding:40px 20px 140px;max-width:var(--maxw);margin:0 auto;display:flex;flex-direction:column;gap:40px}
  section{min-height:70vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 12px;text-align:center;gap:18px;opacity:0}
  .title{font-size:2.2rem;font-weight:800;text-shadow:0 0 18px rgba(0,255,127,0.06)}
  .sub{max-width:980px;color:rgba(0,255,127,0.92);line-height:1.7;font-size:1.02rem}
  .panel{max-width:1100px;width:100%;display:flex;gap:18px;flex-wrap:wrap;align-items:stretch;justify-content:center}
  .media-preview{width:640px;max-width:92%;height:360px;border-radius:12px;overflow:hidden;border:1px solid rgba(0,255,127,0.08);box-shadow:0 12px 40px rgba(0,255,127,0.03)}
  .blog-card{background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.48));border-radius:12px;padding:18px;text-align:left;border:1px solid rgba(0,255,127,0.04)}
  .tilt{transform-style:preserve-3d;will-change:transform;transition:transform .18s cubic-bezier(.2,.9,.3,1)}

  /* Chat VIPRADMA */
  #chatBtn{position:fixed;right:22px;bottom:20px;width:64px;height:64px;border-radius:999px;border:2px solid var(--neon);background:linear-gradient(180deg, rgba(0,255,127,0.03), rgba(0,255,127,0.01));display:flex;align-items:center;justify-content:center;z-index:260;cursor:pointer;box-shadow:0 18px 60px rgba(0,255,127,0.06)}
  #chatPanel{position:fixed;right:22px;bottom:96px;width:360px;max-width:92%;background:var(--panel);backdrop-filter:blur(8px);border-radius:12px;border:1px solid rgba(0,255,127,0.08);padding:12px;display:none;z-index:261}
  #chatHeader{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  #chatTitle{font-weight:800}
  #chatClose{cursor:pointer;border-radius:8px;padding:6px}
  .qa{margin:10px 0;border-radius:10px;overflow:hidden;border:1px solid rgba(0,255,127,0.06)}
  .qHead{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;cursor:pointer;background:linear-gradient(90deg, rgba(0,255,127,0.02), transparent)}
  .qBody{padding:10px 12px;background:rgba(0,0,0,0.45);color:rgba(0,255,127,0.95);display:none}

  /* sound toggle */
  #soundToggle{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:10px;border:1px solid rgba(0,255,127,0.06);cursor:pointer}
  .switch{width:40px;height:20px;border-radius:20px;background:rgba(255,255,255,0.03);position:relative;border:1px solid rgba(0,255,127,0.06)}
  .knob{position:absolute;left:4px;top:50%;transform:translateY(-50%);width:12px;height:12px;border-radius:12px;background:var(--neon);transition:left .18s}

  /* cursor trail */
  .cursorDot{position:fixed;pointer-events:none;z-index:9999;width:16px;height:16px;border-radius:50%;transform:translate(-50%,-50%);display:none}
  canvas.cursorTrail{position:fixed;pointer-events:none;z-index:9998;display:none}

  /* responsive */
  @media (max-width:980px){
    .founderInner{flex-direction:column;gap:20px}
    .founderImage{width:72%;height:42vh}
    .founderText h1{font-size:2rem}
    #typingText{font-size:2rem}
  }
  @media (max-width:640px){
    .founderImage{height:34vh;width:86%}
    .founderText h1{font-size:1.6rem}
    .navBtn{padding:8px 10px}
    .cursorDot, canvas.cursorTrail{display:none}
    #chatPanel{right:10px;left:10px;width:auto}
  }
</style>
</head>
<body>

<!-- background -->
<div id="gridBg" aria-hidden="true"></div>

<!-- audio (place files in assets/) -->
<audio id="enterSound" src="assets/enter.mp3" preload="auto"></audio>
<audio id="bgSound" src="assets/bg-loop.mp3" preload="auto" loop></audio>

<!-- neon loader -->
<div id="neonLoader" role="status" aria-live="polite">
  <div id="bootTitle">Initializing system...</div>
  <div id="bootStep">0%</div>
  <div class="loader-dots"><div class="loader-dot"></div><div class="loader-dot"></div><div class="loader-dot"></div></div>
</div>

<!-- typing intro -->
<div id="intro" aria-hidden="true">
  <div id="typingText" aria-live="polite" aria-atomic="true"></div>
  <button id="enterBtn" aria-label="Enter site">Enter</button>
</div>

<!-- founders full-screen wrapper -->
<div id="foundersWrap" aria-hidden="true"></div>

<!-- scroll progress bar -->
<div id="scrollProgress" aria-hidden="true"><i></i></div>

<!-- header -->
<header role="banner">
  <div class="brand">
    <div class="logo">SNP • Morphine Engine • VH4 Aerospace</div>
    <div class="tag">Prototype • Research • Education</div>
  </div>

  <div class="navWrap">
    <nav class="nav" role="navigation" aria-label="Primary">
      <button class="navBtn" data-target="product">Product</button>
      <button class="navBtn" data-target="vision">Vision</button>
      <button class="navBtn" data-target="propulsion">Propulsion</button>
      <button class="navBtn" data-target="safety">Safety</button>
      <button class="navBtn" data-target="ai">AI / Landing</button>
      <button class="navBtn" data-target="blog">Blog</button>
    </nav>
    <div style="margin-left:12px">
      <div id="soundToggle" role="button" tabindex="0" aria-pressed="false" title="Toggle ambient sound">
        <div style="font-size:.9rem;opacity:.84">Sound</div>
        <div class="switch"><div class="knob" id="knob"></div></div>
      </div>
    </div>
  </div>
</header>

<!-- main content -->
<div id="main" aria-hidden="true">
  <main>
    <section id="product" tabindex="-1">
      <div class="title">Rocket Prototype</div>
      <p class="sub">High-fidelity prototype featuring AI-assisted landing and a fuel-fed propulsion core.</p>
      <div class="panel">
        <div class="media-preview tilt" data-tilt>
          <img src="assets/placeholder-rocket.jpg" alt="Rocket" style="width:100%;height:100%;object-fit:cover" loading="lazy">
        </div>
        <div class="blog-card">
          <h4>Prototype highlights</h4>
          <ul>
            <li>AI-integrated landing stabilization</li>
            <li>3D-printed SS304L nozzle components</li>
            <li>Modular propulsion testbed</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="vision" tabindex="-1">
      <div class="title">Project Vision</div>
      <p class="sub">Democratize aerospace research and bring scalable student innovation to competitions and real-world tests.</p>
    </section>

    <section id="propulsion" tabindex="-1">
      <div class="title">Propulsion & Materials</div>
      <div class="panel">
        <div class="blog-card tilt" data-tilt><h4>Materials & Hardware</h4><p>3D-printed SS306L, Teflon seals, BLDC actuators and MPU-6050 IMU for telemetry.</p></div>
        <div class="blog-card tilt" data-tilt><h4>Chemistry & Performance</h4><p>Engine testing used controlled propellant concentrations under supervised lab conditions.</p></div>
      </div>
    </section>

    <section id="safety" tabindex="-1">
      <div class="title">Safety & Protocol</div>
      <p class="sub">All testing followed supervised school protocols and expert guidance to minimize risk during experiments.</p>
    </section>

    <section id="ai" tabindex="-1">
      <div class="title">AI Assisted Landing</div>
      <p class="sub">AI algorithms for descent control and stabilization — bridging student-built projects and real-world applications.</p>
    </section>

    <section id="blog" tabindex="-1">
      <div class="title">Blog — The Morphine Engine</div>
      <div class="blog-card" style="max-width:1000px">
        <p>The rocket engine was built by students <strong>Vishwajeeth V</strong>, <strong>Adikeshav S</strong>, and <strong>Mahilesh</strong> with school mentorship and safety oversight.</p>
      </div>
      <div class="media-preview" style="margin-top:18px">
        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/0x8x2FamBlk?rel=0&modestbranding=1" frameborder="0" allowfullscreen loading="lazy"></iframe>
      </div>
    </section>
  </main>

  <footer style="padding:44px 20px;text-align:center;color:rgba(0,255,127,0.62)">Credits: SNP Labs • Developed by Pranav R • Supported by : VH4 Aerospace</footer>
</div>

<!-- VIPRADMA Chat button -->
<button id="chatBtn" aria-label="Open chat (VIPRADMA)">
  <svg width="30" height="30" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 6.5A2.5 2.5 0 0 0 18.5 4H5.5A2.5 2.5 0 0 0 3 6.5v9A2.5 2.5 0 0 0 5.5 18H6v3l4.5-3H18.5A2.5 2.5 0 0 0 21 15.5v-9z" fill="var(--neon)"/></svg>
</button>

<!-- VIPRADMA Chat panel -->
<div id="chatPanel" role="dialog" aria-hidden="true">
  <div id="chatHeader">
    <div id="chatTitle">VIPRADMA</div>
    <div id="chatClose" title="Close" role="button" tabindex="0">✕</div>
  </div>

  <div class="qa">
    <div class="qHead" role="button" tabindex="0"><strong>What is this project?</strong><span>+</span></div>
    <div class="qBody">A student-built fuel-based rocket prototype with AI-assisted landing and modular propulsion testing.</div>
  </div>

  <div class="qa">
    <div class="qHead" role="button" tabindex="0"><strong>Who built this?</strong><span>+</span></div>
    <div class="qBody">Built by students: Vishwajeeth V, Adikeshav S, Mahilesh — with facilities and mentorship from SNP Labs.</div>
  </div>

  <div class="qa">
    <div class="qHead" role="button" tabindex="0"><strong>Future goals?</strong><span>+</span></div>
    <div class="qBody">Refine propulsion, optimize safety, compete in science fairs and scale research collaboration.</div>
  </div>
</div>

<!-- cursor trail (desktop) -->
<div class="cursorDot" id="cursorDot" aria-hidden="true"></div>
<canvas class="cursorTrail" id="cursorTrail" aria-hidden="true"></canvas>

<script>
/* ---------- Setup ---------- */
try { gsap.registerPlugin(ScrollTrigger); } catch(e){ console.warn('GSAP not available', e); }

const neonLoader = document.getElementById('neonLoader');
const bootStep = document.getElementById('bootStep');
const intro = document.getElementById('intro');
const typingText = document.getElementById('typingText');
const enterBtn = document.getElementById('enterBtn');
const foundersWrap = document.getElementById('foundersWrap');
const mainWrap = document.getElementById('main');
const scrollProgress = document.querySelector('#scrollProgress > i');
const navBtns = document.querySelectorAll('.navBtn');
const chatBtn = document.getElementById('chatBtn');
const chatPanel = document.getElementById('chatPanel');
const chatClose = document.getElementById('chatClose');
const qHeads = document.querySelectorAll('.qHead');
const enterSound = document.getElementById('enterSound');
const bgSound = document.getElementById('bgSound');
const soundToggle = document.getElementById('soundToggle');
const knob = document.getElementById('knob');
const cursorDot = document.getElementById('cursorDot');
const trailCanvas = document.getElementById('cursorTrail');

/* Founders (from your upload) */
const founders = [
  {id:'vish', name:'Vishwajeeth V', role:'Lead Rocket Engineer', bio:'Lead on nozzle design, test protocols and assembly. Focused on high temperature materials and structural integrity.', img:'assets/Vishwajeeth.jpg'},
  {id:'adhi', name:'Adikeshav S', role:'Systems & Control Engineer', bio:'Embedded systems lead — sensor fusion, flight control and AI-assisted stabilization algorithms.', img:'assets/Adhikesav.jpg'},
  {id:'mahi', name:'Mahilesh', role:'Operations & Mission Support', bio:'Mission planning, operations coordination and test logistics. Ensures safety and documentation during tests.', img:'assets/Mahilesh.jpg'}
];

/* ---------- Boot fake progress ---------- */
(function boot(){
  let pct = 0;
  const t = setInterval(()=>{
    pct += Math.floor(Math.random()*9)+6;
    if (pct >= 100) pct = 100;
    bootStep.textContent = pct + '%';
    if (pct >= 100){
      clearInterval(t);
      gsap.to(neonLoader, {opacity:0, duration:.7, delay:.35, onComplete: ()=> neonLoader.style.display = 'none'});
      setTimeout(() => startTyping(), 600);
    }
  }, 100);
})();

/* ---------- Typing intro (WAIT for user click) ---------- */
const introMsg = "Ready to dive in?";
function startTyping(){
  intro.style.display = 'flex';
  intro.setAttribute('aria-hidden','false');
  typingText.textContent = '';
  enterBtn.style.opacity = 0; enterBtn.style.transform = 'translateY(8px)';
  let i = 0;
  const speed = 58;
  (function typeChar(){
    if (i < introMsg.length) {
      typingText.textContent += introMsg[i++];
      gsap.fromTo(typingText, {textShadow:'0 0 6px rgba(0,255,127,0.06)'}, {textShadow:'0 0 26px rgba(0,255,127,0.22)', duration:.12});
      setTimeout(typeChar, speed);
    } else {
      gsap.to(enterBtn, {opacity:1, y:0, duration:.45, ease:'power2.out'});
      // WAIT: Do NOT auto-click. User must click Enter.
    }
  })();
}

/* ---------- Build founders screens ---------- */
function buildFounderScreens(){
  foundersWrap.innerHTML = '';
  founders.forEach((f, i) => {
    const s = document.createElement('div');
    s.className = 'founderScreen';
    s.id = 'founder-' + (f.id || i);
    s.innerHTML = `
      <div class="founderInner" role="dialog" aria-label="${f.name} intro">
        <div class="founderImage"><img src="${f.img}" alt="${f.name}"></div>
        <div class="founderText"><h1>${f.name}</h1><p class="role">${f.role}</p><p class="bio">${f.bio}</p></div>
      </div>`;
    foundersWrap.appendChild(s);
  });
}
buildFounderScreens();

/* ---------- Enter click: start cinematic & play sounds ---------- */
enterBtn.addEventListener('click', startCinematic);
enterBtn.addEventListener('keyup', (e)=> { if (e.key === 'Enter') startCinematic(); });

function startCinematic(){
  // user gesture: play enter sound and start bg music
  try { const p1 = enterSound.play(); if (p1 && p1.catch) p1.catch(()=>{}); } catch(e){}
  // hide intro
  gsap.to(intro, {opacity:0, y:-80, duration:.85, ease:'power3.inOut', onComplete: ()=> { intro.style.display = 'none'; }});
  // play bg music (user gesture happened via click)
  try { const p2 = bgSound.play(); if (p2 && p2.catch) p2.catch(()=>{}); } catch(e){}
  // run cinematic after short delay
  setTimeout(()=> runFoundersCinematic(), 400);
}

/* ---------- Cinematic timeline (slow & cinematic) ---------- */
function runFoundersCinematic(){
  const screens = Array.from(document.querySelectorAll('.founderScreen'));
  foundersWrap.style.display = 'block';
  foundersWrap.setAttribute('aria-hidden','false');

  const tl = gsap.timeline({onComplete: revealMain});
  screens.forEach((s, idx) => {
    tl.fromTo(s, {autoAlpha:0, scale:1.04}, {autoAlpha:1, scale:1.0, duration:1.05, ease:'power3.out'});
    tl.fromTo(s.querySelector('.founderInner'), {y:20, opacity:0}, {y:0, opacity:1, duration:.9, ease:'power3.out'}, '<');
    tl.to({}, {duration:2.1}); // hold
    tl.to(s, {yPercent: -100, autoAlpha:0, duration:0.9, ease:'power2.in'});
  });
}

/* ---------- Reveal main ---------- */
function revealMain(){
  foundersWrap.style.display = 'none';
  foundersWrap.setAttribute('aria-hidden','true');

  mainWrap.style.visibility = 'visible';
  mainWrap.setAttribute('aria-hidden','false');
  gsap.fromTo(mainWrap, {opacity:0, y:18}, {opacity:1, y:0, duration:1.2, ease:'power3.out', onComplete: initScrollAnims});
}

/* ---------- Scroll animations & nav ---------- */
function initScrollAnims(){
  const secs = document.querySelectorAll('main section');
  secs.forEach((s) => {
    if (gsap && ScrollTrigger) {
      gsap.fromTo(s, {opacity:0, y:28}, {
        opacity:1, y:0, duration:0.9, ease:'power3.out',
        scrollTrigger:{trigger:s, start:"top 82%"}
      });
    } else {
      s.style.opacity = 1; s.style.transform = 'translateY(0)';
    }
  });
  if (ScrollTrigger) {
    secs.forEach(sec=>{
      ScrollTrigger.create({
        trigger: sec, start: "top 60%", end: "bottom 20%",
        onEnter: ()=> setActiveNav(sec.id), onEnterBack: ()=> setActiveNav(sec.id)
      });
    });
  }
}
function setActiveNav(id){ document.querySelectorAll('.navBtn').forEach(b => b.classList.toggle('active', b.dataset.target === id)); }

/* nav click */
document.querySelectorAll('.navBtn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const target = document.getElementById(btn.dataset.target);
    if (!target) return;
    target.scrollIntoView({behavior:'smooth', block:'start'});
  });
});

/* scroll progress */
window.addEventListener('scroll', ()=> {
  const d = document.documentElement;
  const top = d.scrollTop || document.body.scrollTop;
  const height = d.scrollHeight - d.clientHeight;
  const pct = Math.max(0, Math.min(1, top/height));
  const bar = document.querySelector('#scrollProgress > i');
  if (bar) bar.style.width = (pct*100) + '%';
});

/* Chat toggle & collapsibles */
chatBtn.addEventListener('click', toggleChat);
chatClose.addEventListener('click', closeChat);
chatClose.addEventListener('keyup', (e)=> { if (e.key === 'Enter') closeChat(); });

function toggleChat(){
  const open = chatPanel.style.display === 'block';
  chatPanel.style.display = open ? 'none' : 'block';
  chatBtn.setAttribute('aria-expanded', String(!open));
  chatPanel.setAttribute('aria-hidden', String(open));
}
function closeChat(){ chatPanel.style.display = 'none'; chatBtn.setAttribute('aria-expanded','false'); chatPanel.setAttribute('aria-hidden','true'); }

qHeads.forEach(h=> {
  h.addEventListener('click', ()=> {
    const body = h.nextElementSibling;
    const open = body.style.display === 'block';
    if (open) { gsap.to(body, {opacity:0, y:-6, duration:.22, onComplete: ()=> body.style.display = 'none'}); h.querySelector('span').textContent = '+'; }
    else { body.style.display = 'block'; gsap.fromTo(body, {opacity:0, y:-6}, {opacity:1, y:0, duration:.28}); h.querySelector('span').textContent = '–'; }
  });
  h.addEventListener('keyup', (e)=> { if (e.key === 'Enter') h.click(); });
});

/* sound toggle */
if (knob) knob.dataset.on = 'true'; // default: on once user clicked enter (we started bgSound)
if (soundToggle) {
  soundToggle.addEventListener('click', ()=> {
    const on = knob.dataset.on === 'true';
    if (!on) { knob.style.left = '24px'; knob.dataset.on = 'true'; try { bgSound.play().catch(()=>{}); } catch(e){} }
    else { knob.style.left = '4px'; knob.dataset.on = 'false'; try { bgSound.pause(); bgSound.currentTime = 0; } catch(e){} }
  });
}

/* tilt */
function initTilts(){
  document.querySelectorAll('[data-tilt], .tilt').forEach(el=>{
    el.addEventListener('pointermove', ev=>{
      const r = el.getBoundingClientRect();
      const px = (ev.clientX - r.left)/r.width;
      const py = (ev.clientY - r.top)/r.height;
      const rx = (py - 0.5) * 8;
      const ry = (px - 0.5) * -8;
      el.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg) scale(1.01)`;
    });
    el.addEventListener('pointerleave', ()=> el.style.transform = '');
  });
}
initTilts();

/* cursor trail (desktop) */
(function initCursor(){
  const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
  if (isTouch || window.innerWidth < 720) return;
  cursorDot.style.display = 'block';
  trailCanvas.style.display = 'block';
  const ctx = trailCanvas.getContext('2d');
  let w = trailCanvas.width = innerWidth, h = trailCanvas.height = innerHeight;
  const pts = [], max = 28;
  window.addEventListener('resize', ()=> { w = trailCanvas.width = innerWidth; h = trailCanvas.height = innerHeight; });
  window.addEventListener('pointermove', (e)=> {
    cursorDot.style.left = e.clientX + 'px'; cursorDot.style.top = e.clientY + 'px';
    cursorDot.style.boxShadow = '0 0 12px 3px rgba(0,255,127,0.08)';
    pts.push({x:e.clientX, y:e.clientY});
    if (pts.length > max) pts.shift();
  });
  function render(){
    ctx.clearRect(0,0,w,h);
    for (let i=0;i<pts.length;i++){
      const p = pts[i]; const alpha = (i+1)/pts.length * 0.34; const size = 18 * ((i+1)/pts.length) * 0.78;
      ctx.beginPath(); ctx.fillStyle = `rgba(0,255,127,${alpha})`; ctx.arc(p.x, p.y, size, 0, Math.PI*2); ctx.fill();
    }
    requestAnimationFrame(render);
  }
  render();
})();

/* accessibility */
document.addEventListener('keydown', (e)=> {
  if (e.key === 'Escape') { chatPanel.style.display = 'none'; chatBtn.setAttribute('aria-expanded','false'); }
});

/* defensive */
window.addEventListener('error', (ev)=> console.error('JS Error:', ev.message || ev.error));
</script>
</body>
</html>
